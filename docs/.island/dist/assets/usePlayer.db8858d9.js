import{useState as n,useEffect as p,useRef as d,useCallback as P}from"react";import{l as z}from"./log.83f32a09.js";import{h as $,D as rr}from"./index.6eef3859.js";const or=D=>{const{url:I,requestOptions:R,onSuccess:v,onError:y}=D,[E,w]=n(!0),[h,T]=n(!1),[l,r]=n(!1),[u,s]=n(""),[o,f]=n(null),[g,b]=n(null);p(()=>{!l||(z.error(u),y&&y())},[l]);const k=async()=>{try{const c=await fetch(I,R);if(f(c),w(!1),c.ok)T(!0),m(await c.arrayBuffer()),v&&v();else throw new Error(c.statusText)}catch(c){r(!0),s(c)}},m=async c=>{if(!l)try{const F=await new AudioContext().decodeAudioData(c);b(F)}catch(A){r(!0),s(A)}};return{pending:E,fetched:h,error:l,errorMessage:u,response:o,audioBuffer:g,fetchAudio:k}},er=5,tr=!1,nr=!1,ar=(D={})=>{var j;const{volume:I=er,loop:R=tr,mute:v=nr,onReady:y,onPlay:E,onPause:w,onStop:h,onFinish:T,onError:l}=D,r=d(null),u=d(0),s=d(0),o=d(0),f=d(0),g=d(0),[b,k]=n(!1),[m,c]=n(!1),[A,F]=n(!1),[M,G]=n(I),[C,H]=n(R),[O,J]=n(v),[B,L]=n(0),[K,N]=n(0),[t,a]=n(!1),[U,i]=n("");p(()=>()=>{!r.current||(r.current.stop(),r.current.dispose())},[]),p(()=>{if(!r.current)return;const e=B/f.current*100;N(e)},[B]),p(()=>{if(!(!r.current||t)&&!(!m||r.current.state==="started"))try{c(!1),F(!0),u.current=0,s.current=0,o.current=0,q(),L(f.current),T&&T()}catch(e){a(!0),i(e)}},[(j=r.current)==null?void 0:j.state]),p(()=>{if(!(!r.current||t))try{r.current.loop=C,r.current.mute=O,r.current.volume.value=O?-1/0:M}catch(e){a(!0),i(e)}},[r.current,M,C,O]),p(()=>{!t||(z.error(U),l&&l())},[t]);const Q=(e,x=[])=>{if(!!e)try{r.current=new $(e),r.current.volume.value=M,f.current=e.duration,x!=null&&x.length?r.current.chain(...x,rr):r.current.toDestination(),k(!0),y&&y()}catch(Z){a(!0),i(Z)}},V=P(()=>{if(!(!r.current||t))try{m&&r.current.stop();const e=o.current?o.current:s.current;r.current.start(void 0,e),u.current=r.current.immediate()-e,s.current=0,c(!0),F(!1),E&&E()}catch(e){a(!0),i(e)}},[r.current,o.current,s.current,t]),W=P(()=>{if(!(!r.current||t))try{r.current.stop();const e=r.current.immediate()-u.current;s.current=e%f.current,o.current=0,c(!1),w&&w()}catch(e){a(!0),i(e)}},[r.current,u.current,t]),X=P(()=>{if(!(!r.current||t))try{r.current.stop(),c(!1),s.current=0,u.current=0,o.current=0,L(0),h==null||h()}catch(e){a(!0),i(e)}},[r.current,t]),Y=e=>{!r.current||t||(o.current=e,m&&(V(),q()))},_=P(()=>{if(!(!r.current||t))try{let e;s.current?e=s.current:u.current?e=r.current.immediate()-u.current:e=r.current.immediate(),e=e%f.current,L(e)}catch(e){a(!0),i(e)}},[r.current,u.current,t]),S=P(()=>{if(!(!r.current||t))try{_(),g.current=requestAnimationFrame(S)}catch(e){a(!0),i(e)}},[_,t]),q=()=>{if(!(!r.current||t)&&!!g.current)try{cancelAnimationFrame(g.current)}catch(e){a(!0),i(e)}};return{player:r,audioDuration:f,isReady:b,isPlaying:m,isFinish:A,volume:M,loop:C,mute:O,time:B,percentage:K,pickTime:o,init:Q,play:V,pause:W,stop:X,getTime:_,setPickTime:Y,setVolume:G,setLoop:H,setMute:J,observe:S,cancelObserve:q,error:t,errorMessage:U}};export{ar as a,or as u};
