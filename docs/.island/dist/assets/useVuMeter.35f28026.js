import{T as E,o as V,k as q,l as F}from"./index.6eef3859.js";import{useRef as l,useState as y,useEffect as b,useCallback as g}from"react";import{l as L}from"./log.83f32a09.js";import{A as R,S as T}from"./Analyser.9e774fcc.js";class p extends E{constructor(){super(V(p.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new R({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class u extends p{constructor(){super(V(u.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const e=V(u.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new R({context:this.context,size:256,type:"waveform",channels:e.channels}),this.smoothing=e.smoothing,this.normalRange=e.normalRange}static getDefaults(){return Object.assign(p.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return q("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const e=this._analyser.getValue(),c=(this.channels===1?[e]:e).map(r=>{const s=r.reduce((o,n)=>o+n*n,0),a=Math.sqrt(s/r.length);return this._rms=Math.max(a,this._rms*this.smoothing),this.normalRange?this._rms:F(this._rms)});return this.channels===1?c[0]:c}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}const B=D=>{const{value:e,onReady:f,onError:c}=D,r=Array.isArray(e),s=l(null),a=l(null),o=l(null),n=l(null),d=l(0),[M,v]=y(e),[i,h]=y(!1),[w,m]=y("");b(()=>()=>{!s.current||(s.current.dispose(),A())},[]),b(()=>{!i||(L.error(w),c&&c())},[i]);const S=g(()=>{try{r?(a.current=new u,o.current=new u,n.current=new T,n.current.connect(a.current,0),n.current.connect(o.current,1)):s.current=new u,f&&f()}catch(t){h(!0),m(t)}},[]),_=g(()=>{if(!i&&!(!r&&!s.current)&&!(r&&(!a.current||!o.current)))try{let t;r?t=[a.current.getValue(),o.current.getValue()]:t=s.current.getValue(),v(t)}catch(t){h(!0),m(t)}},[]),x=g(()=>{try{_(),d.current=requestAnimationFrame(x)}catch(t){h(!0),m(t)}},[]),A=g(()=>{if(!(!d.current||i))try{v(e),cancelAnimationFrame(d.current)}catch(t){h(!0),m(t)}},[e]);return{meter:r?n:s,value:M,init:S,getValue:_,observe:x,cancelObserve:A,error:i,errorMessage:w}};export{B as u};
