import{k as Q,r as O,n as $,d as k,p as G,$ as A,U as v,A as j,c as s}from"./index.a54ae35d.js";import n from"react";import{jsxs as z,jsx as e}from"react/jsx-runtime";import{T as D,o as T,G as M,h as B,g as U,j as V}from"./index.3fdeaba1.js";import{F as R}from"./Filter.9ff151a0.js";class E extends D{constructor(){super(T(E.getDefaults(),arguments,["channels"])),this.name="Split";const t=T(E.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(D.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class F extends D{constructor(){super(T(F.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const t=T(F.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new M({context:this.context}),this._split=new E({context:this.context,channels:t.channels}),this.input.connect(this._split),B(t.channels,1);for(let r=0;r<t.channels;r++)this._analysers[r]=this.context.createAnalyser(),this._split.connect(this._analysers[r],r,0);this.size=t.size,this.type=t.type}static getDefaults(){return Object.assign(D.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,r)=>{const o=this._buffers[r];this._type==="fft"?t.getFloatFrequencyData(o):this._type==="waveform"&&t.getFloatTimeDomainData(o)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((r,o)=>{r.fftSize=t*2,this._buffers[o]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){U(t==="waveform"||t==="fft",`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(r=>r.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}const Y=()=>{const c="/audios/loop-2.mp3",{audioBuffer:t,pending:r,fetchAudio:o}=Q({url:c}),{analyser:p,data:f,init:l,observe:g,cancelObserve:h}=O({fftSize:512}),{isPlaying:i,init:m,play:y,stop:b}=$({onPlay:()=>g(),onPause:()=>h(),onStop:()=>h()});return n.useEffect(()=>{o(),l()},[]),n.useEffect(()=>{!p.current||m(t,[p.current])},[t,p.current]),z("div",{className:"flex flex-col items-center gap-2",children:[e(k,{className:"w-full",data:f}),e(G,{onClick:async()=>{i?b():y()},disabled:r,toggled:i,children:i?"Stop":"Start"})]})},X=()=>{const c="/audios/loop-2.mp3",[t,r]=n.useState([]),[o,p]=n.useState(!1),f=n.useRef(),l=n.useRef(null),g=n.useRef(null),h=n.useRef(null),i=n.useRef(null),m=512/2,y=300,b=1500,C=4e3,[x,H]=n.useState(0),[S,I]=n.useState(0),[_,P]=n.useState(0);n.useEffect(()=>{var a,u;return l.current=new V(c),f.current=new F("fft",m),g.current=new R(y,"lowshelf"),h.current=new R(b,"peaking"),i.current=new R(C,"highshelf"),l.current.connect(g.current),g.current.connect(h.current),(a=h.current)==null||a.connect(i.current),(u=i.current)==null||u.toDestination(),()=>{var d,w;(d=i.current)==null||d.disconnect(),(w=i.current)==null||w.dispose()}},[]),n.useEffect(()=>{var a,u,d;(a=g.current)==null||a.set({frequency:y,gain:x}),(u=h.current)==null||u.set({frequency:b,gain:S}),(d=i.current)==null||d.set({frequency:C,gain:_})},[x,S,_]);const W=async()=>{var a;if(!l.current||!f.current){console.error("Oscillator or Analyser is not initialized");return}o?(l.current.stop(),cancelAnimationFrame(L.current),r([]),p(!1)):((a=i.current)==null||a.connect(f.current),l.current.loop=!0,l.current.start(),p(!0),q())},L=n.useRef(0),q=()=>{var u;const a=(u=f.current)==null?void 0:u.getValue();if(a instanceof Float32Array){const d=Array.from(a).map((w,N)=>({frequency:N,amplitude:w}));r(d)}L.current=requestAnimationFrame(q)};return z("div",{className:"w-full flex flex-col items-center gap-2",children:[z(A.Group,{size:50,trackWidth:2,pointerWidth:5,pointerHeight:5,min:-25,max:25,bilateral:!0,children:[e(A,{topLabel:"LOW",bottomLabel:`${x}`,value:x,onChange:H}),e(A,{topLabel:"MID",bottomLabel:`${S}`,value:S,onChange:I}),e(A,{topLabel:"HIGH",bottomLabel:`${_}`,value:_,onChange:P})]}),e(k,{className:"w-full h-52",data:t,fftSize:m,axis:!0,grid:!0,shadow:!0}),e(G,{onClick:W,toggled:o,children:o?"Stop":"Start"})]})},se=()=>e(v,{code:"<SpectrogramDefault />",scope:{SpectrogramDefault:Y},type:"link",url:"https://github.com/codeacme17/echo-ui/blob/main/docs/src/components/Example/SpectrogramDefault.tsx",classNames:{preview:"p-0 px-3 py-5"}}),re=()=>e(v,{code:`<Spectrogram 
  axis 
  amplitudeRange={[-120, 20]} 
  xAxisTicks={[50, 500, 5000]} 
  yAxisTicks={[10, -60, -80]} 
/>`,scope:{Spectrogram:k}}),ne=()=>e(v,{code:`<Spectrogram 
  grid
  amplitudeRange={[-120, 20]} 
  xAxisTicks={[50, 500, 5000]} 
  yAxisTicks={[10, -60, -80]} 
/>`,scope:{Spectrogram:k}}),ie=()=>e(v,{code:"<SpectrogramEQ3 />",scope:{SpectrogramEQ3:X},type:"link",url:"https://github.com/codeacme17/echo-ui/blob/main/docs/src/components/Example/SpectrogramEQ3.tsx",classNames:{preview:"p-0 px-3 py-5"}}),ae=()=>e(j,{data:[{attribute:"data*",description:"Array data passed to the spectrogram(required)",type:e(s,{children:"SpectrogramDataPoint[]"}),default:"-"},{attribute:"fftSize",description:"Size of the Fast Fourier Transform (FFT) (must be a power of 2)",type:e(s,{children:"number"}),default:e(s,{children:"1024"})},{attribute:"amplitudeRange",description:"Amplitude range, this property specifies the range of the Y-axis",type:e(s,{children:"[number, number]"}),default:e(s,{children:"[-100, 10]"})},{attribute:"lineColor",description:"Line color",type:e(s,{children:"string"}),default:e(s,{children:"'var(--echo-primary)'"})},{attribute:"lineWidth",description:"Line width",type:e(s,{children:"number"}),default:e(s,{children:"2"})},{attribute:"axis",description:"Whether to display the axis",type:e(s,{children:"boolean"}),default:e(s,{children:"false"})},{attribute:"axisColor",description:"Axis font color",type:e(s,{children:"string"}),default:e(s,{children:"'var(--echo-muted-foreground)'"})},{attribute:"xAxisTicks",description:"Ticks displayed on the X-axis",type:e(s,{children:"number[]"}),default:e(s,{children:"[50, 100, 200, 500, 1000, 2000, 5000, 10000]"})},{attribute:"yAxisTicks",description:"Ticks displayed on the Y-axis",type:e(s,{children:"number[]"}),default:e(s,{children:"[-80, -60, -20, 0]"})},{attribute:"grid",description:"Whether to display grid lines",type:e(s,{children:"boolean"}),default:e(s,{children:"false"})},{attribute:"gridColor",description:"Grid line color",type:e(s,{children:"string"}),default:e(s,{children:"'var(--echo-background)'"})},{attribute:"shadow",description:"Whether to display shadow",type:e(s,{children:"boolean"}),default:e(s,{children:"false"})},{attribute:"shadowColor",description:"Shadow color",type:e(s,{children:"string"}),default:e(s,{children:"'var(--echo-primary)'"})},{attribute:"shadowDirection",description:"Shadow direction",type:e(s,{children:"'top' | 'bottom'"}),default:e(s,{children:"'bottom'"})},{attribute:"shadowHeight",description:"Shadow height",type:e(s,{children:"number"}),default:e(s,{children:"20"})}]});export{re as A,se as D,ie as E,ne as G,ae as S};
