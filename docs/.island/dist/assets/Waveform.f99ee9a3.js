import Q,{forwardRef as pe,useImperativeHandle as ge,useRef as k,useState as x,useEffect as j,useMemo as ye}from"react";import{jsxs as U,jsx as e}from"react/jsx-runtime";import{u as ve,a as be}from"./usePlayer.db8858d9.js";import{s as we,l as Ce}from"./log.83f32a09.js";import{l as Y}from"./transform.3e3dfeca.js";import{c as H,e as ke,f as Z,U as De,A as Ne,a as t}from"./index.978ae265.js";import{s as xe}from"./index.93441784.js";import{u as Te}from"./line.c32ceb13.js";import{a as Me}from"./area.16ffd65c.js";import{B as S}from"./index.2ccb91f8.js";import{c as ee}from"./CodeBlock.d8e569ad.js";import{S as Ae}from"./square.0deaf827.js";import{P as Re}from"./pause.821e66c4.js";import{P as Pe}from"./play.c5eb55f2.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ee("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ee("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),He=xe({slots:{base:`text-foreground
    relative
    w-96
    h-20
    flex
    justify-center
    rounded-md
    bg-card`,svg:`w-full
    cursor-pointer
    absolute
    top-0
    left-0
    h-full
    flex
    items-center`,cursor:`h-full
    absolute
    top-1/2
    transform
    -translate-y-1/2
    z-10
    transition-[background-color]
    cursor-pointer`,label:`absolute 
    left-2.5 
    top-2 
    text-primary 
    text-sm`}}),Se=500,Ie=100,_e=100,Oe="var(--echo-wave)",Le="var(--echo-primary)",Be="var(--echo-muted-foreground)",je=2,ze=300,Ue=pe((D,c)=>{const{data:d,audioDuration:i=0,percentage:y=0,hideCursor:T=!1,cursorWidth:v=je,cursorColor:r=Be,hideCursorLabel:b=!1,waveHeight:w=_e,waveColor:N=Oe,maskColor:M=Le,disableAnimation:A=!1,animationDuration:R=ze,onMouseMove:o,onMouseLeave:n,onClick:h,...f}=D;ge(c,()=>l.current);const s=k(null),l=k(null),P=k(null),I=k(null),_=k(null),m=k(null),E=k(!1),[re,X]=x(y),[O,ae]=x(null),[z,q]=x(!1),[oe,ne]=x(0),V=Te(l,Se,Ie,()=>{G(),$(),F()},E.current);j(()=>{d.length===2?s.current=d:s.current=[...d,...d],G(),$(),F()},[d]),j(()=>{X(y)},[y]);const G=()=>{var g,L;const{width:u,height:p}=V.current,a=(g=s.current)!=null&&g.length?(L=s.current)==null?void 0:L[0].length:0;_.current=Y().domain([0,a]).range([0,u]),m.current=Y().domain([-1,1]).range([p-p*((100-w)/200),p*((100-w)/200)])},$=()=>{K(P,N)},F=()=>{K(I,M)},K=(u,p)=>{if(!u.current||!s.current||s.current.length!==2)return;const a=we(u.current);a.selectAll("*").remove();const{width:g,height:L}=V.current;a.attr("width",g).attr("height",L);const B=Me().x((C,W)=>_.current(W));E.current||A?B.y0(C=>m.current(-C)).y1(C=>m.current(C)):B.y0(()=>m.current(0)).y1(()=>m.current(0));const[fe,me]=[s.current[0],s.current[1]].map(C=>a.append("path").datum(C).attr("class","echo-path-area").attr("d",B).attr("fill",p));E.current||[fe,me].forEach(C=>{C.transition().duration(R).attr("d",B.y0(W=>m.current(-W)).y1(W=>m.current(W))).on("end",()=>{E.current=!0})})},se=u=>{const{left:p,width:a}=l.current.getBoundingClientRect(),g=Math.max(0,Math.min(a,u.clientX-p));q(!0),ae(g),ne(Z(g/a*i,0)),o==null||o({time:g/a*i,percentage:g/a*100,nativeEvent:u})},ce=u=>{q(!1),n==null||n(u)},ie=u=>{const{width:p}=l.current.getBoundingClientRect(),a=Z(O/p*100);X(a),h==null||h({time:a/100*i,percentage:a,nativeEvent:u})},le=ye(()=>({width:v,left:O?O-v/2:0,backgroundColor:z?r:"transparent"}),[z,O,v,r]),{base:ue,svg:J,cursor:de,label:he}=He();return U("div",{...f,ref:l,className:H(ue(),f.className),style:{...f.style,userSelect:"none"},onClick:ie,onMouseMove:se,onMouseLeave:ce,children:[e("svg",{ref:P,className:H(J())}),e("svg",{ref:I,className:H(J()),style:{clipPath:`inset(0 ${100-re}% 0 0)`}}),!T&&E.current&&e("div",{className:H(de()),style:le,children:!b&&e("span",{className:H(he()),style:{color:z?r:"transparent"},children:ke(oe)})})]})}),te=Ue;te.displayName="EchoUI.Waveform";const Xe=2,qe=512*2,Ve=D=>{const{audioBuffer:c,channel:d=Xe,samples:i=qe}=D,[y,T]=x([]),v=k(0),[r,b]=x(!1),[w,N]=x("");j(()=>{y.length||(A(),M())},[d,i,c]),j(()=>{r&&Ce.error(w)},[r]);const M=()=>{if(!(r||!c))try{v.current=c.duration}catch(o){b(!0),N(o)}},A=async()=>{if(!(r||!c))try{const n=(d===1?[c.getChannelData(0)]:[c.getChannelData(0),c.getChannelData(1)]).map(h=>R(h));T(n)}catch(o){b(!0),N(o)}},R=o=>{if(!r)try{const n=Math.floor(o.length/i),h=[];for(let f=0;f<i;f++){let s=0;for(let l=0;l<n;l++)s+=Math.abs(o[n*f+l]);h.push(s/n)}return h}catch(n){b(!0),N(n)}};return{data:y,audioDuration:v,error:r,errorMessage:w}},Ge=()=>{const D="/audios/loop-6.mp3",{pending:c,error:d,audioBuffer:i,fetchAudio:y}=ve({url:D}),{data:T}=Ve({audioBuffer:i}),{isReady:v,isPlaying:r,loop:b,mute:w,percentage:N,audioDuration:M,init:A,setMute:R,setLoop:o,setPickTime:n,play:h,pause:f,stop:s,observe:l,cancelObserve:P}=be({onPlay:()=>l(),onPause:()=>P(),onStop:()=>P()});Q.useEffect(()=>{y()},[]),Q.useEffect(()=>{!i||A(i)},[i]);const I=()=>{r?f():h()},_=m=>{n(m.time)};return U("section",{className:"w-full flex flex-col justify-center items-center",children:[e(te,{data:T,audioDuration:M.current,percentage:N,onClick:_,className:"w-full h-24"}),U(S.Group,{className:"mt-3",disabled:c||d||!v,children:[e(S,{className:"p-2",onClick:()=>o(!b),toggled:b,children:e(Ee,{className:"w-4 h-4 fill-current"})}),e(S,{className:"p-2",onClick:()=>s(),children:e(Ae,{className:"w-4 h-4 fill-current"})}),e(S,{onClick:I,toggled:r,children:r?e(Re,{className:"w-4 h-4 fill-current"}):e(Pe,{className:"w-4 h-4 fill-current"})}),e(S,{className:"p-2 data-[toggled=true]:bg-red-500",onClick:()=>R(!w),toggled:w,children:e(We,{className:"w-4 h-4 fill-current"})})]})]})},ct=()=>e(De,{code:"<WaveformDefault />",scope:{WaveformDefault:Ge},type:"link",url:"https://github.com/codeacme17/echo-ui/blob/main/docs/src/components/Example/WaveformDefault.tsx",className:"p-0 px-3 py-5",classNames:{preview:"overflow-hidden"}}),it=()=>e(Ne,{data:[{attribute:"data*",description:"The data of the waveform, if pass a 2D array will render stereo waveform(required)",type:e(t,{children:"number[] | number[][]"}),default:"-"},{attribute:"audioDuration*",description:"The duration of the audio(required)",type:e(t,{children:"number"}),default:"-"},{attribute:"percentage",description:"The width percentage of the mask layer compared to the waveform",type:e(t,{children:"number"}),default:e(t,{children:"0"})},{attribute:"waveHeight",description:"The percentage of this waveform compared to the height of the container",type:e(t,{children:"number"}),default:e(t,{children:"100"})},{attribute:"waveColor",description:"The color of the waveform",type:e(t,{children:"string"}),default:e(t,{children:"'var(--echo-wave)'"})},{attribute:"maskColor",description:"The color of the mask layer",type:e(t,{children:"string"}),default:e(t,{children:"'var(--echo-primary)'"})},{attribute:"hideCursor",description:"Hide the cursor",type:e(t,{children:"boolean"}),default:e(t,{children:"false"})},{attribute:"cursorWidth",description:"The width of the cursor",type:e(t,{children:"number"}),default:e(t,{children:"2"})},{attribute:"cursorColor",description:"The color of the cursor",type:e(t,{children:"string"}),default:e(t,{children:"'var(--echo-muted-foreground)'"})},{attribute:"hideCursorLabel",description:"Hide the time label of the cursor",type:e(t,{children:"boolean"}),default:e(t,{children:"false"})},{attribute:"disableAnimation",description:"Disable animation when waveform is initialized",type:e(t,{children:"boolean"}),default:e(t,{children:"false"})},{attribute:"animationDuration",description:"The duration of the animation, in milliseconds",type:e(t,{children:"number"}),default:e(t,{children:"300"})},{attribute:"onClick",description:"The callback function when click the waveform",type:e(t,{children:"(e: WaveformMouseEvent) => void"}),default:"-"},{attribute:"onMouseMove",description:"The callback function when move the mouse on the waveform",type:e(t,{children:"(e: WaveformMouseEvent) => void"}),default:"-"}]});export{ct as D,it as W};
